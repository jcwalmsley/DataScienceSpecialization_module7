---
title: "Regression Models Project - Motor Trend Data 'mtcars' Miles Per Gallon Analysis"
author: "james c walmsley"
date: "12/1/2016"
output: 
  pdf_document: 
    fig_caption: yes
    fig_crop: yes
    fig_height: 6
    fig_width: 6
---

# I.            Executive Summary:  
        ## Add after completing analysis
        NOTE: include some info on cor, confint, ChisSq?, VIF
# II.           Problem Statement & Questions to Answer:  
                ## Q1 “Is an automatic or manual transmission better for 'mpg'”  
                ## Q2 "Quantify the MPG difference between automatic and manual transmissions"  
---

#               Grading - Criteria (remove on completion)!!!  
???? Did the report include an executive summary?  
???? Did the student answer the questions of interest or detail why the question(s) is (are) not answerable?  
???? Did the student quantify the uncertainty in their conclusions and/or perform an inference correctly?  
???? Was the report brief (about 2 pages long) for the main body of the report and no longer than 5 with supporting appendix of figures?  


YES!!!! Did the student interpret the coefficients correctly?  
YES!!!! Did the student do some exploratory data analyses?  


YES!!!! Did the student fit multiple models and detail their strategy for model selection?  
Needs some more work


YES!!!! Did the student do a residual plot and some diagnostics?  
YES!!!! Was the report done in Rmd (knitr) with pdf output?  

---

# III.          Analysis Considerations:
        Descriptive - (dim, mean, sd, sigma^2, str & summary) statistics
        
        Exploratory - pairs, histograms, QQ, fitted, residualplots, boxplots  
        & (multiple plots); T-Test
        
        Analysis -  OLS, simple linear regression, statistical linear regression,  
        multivariate regression & model selection, logistic regression, pValues,  
        adjustments, residuals, residual fit, predict fit, hatvalues, variance, & dfbetas, R^2,  
        diagnostics; ANOVA, coeficients, confint, correlation, covariance, variance inflation

# IV.           Software Environment: &  System - session Info:
        Set the Working Directory then get System & Session Info
```{r SetDirectory, eval=FALSE, include=FALSE, results='hide'}
setwd("~/Desktop/Coursera_R/7_Regression Models/RM_proj_MPG_MotorTrendData")
sessionInfo()
```        
       
# V.            Accessing Data & Raw Data Overview: Motor Trend 'mtcars' data set:
        Clean up the work space & get the data: 
```{r Data_mtcars, include=FALSE, results='hide'}
rm(list=ls());library(car);library(dplyr); data("mtcars");any(is.na(mtcars));data(mtcars)
```
A data frame with 32 observations on 11 variables.  

[, 1]	mpg	Miles/(US) gallon  
[, 2]	cyl	Number of cylinders (4,6,8)
[, 3]	disp	Displacement (cu.in.)  
[, 4]	hp	Gross horsepower  
[, 5]	drat	Rear axle ratio  
[, 6]	wt	Weight (1000 lbs)  
[, 7]	qsec	1/4 mile time  
[, 8]	vs	V/S (V = vee-block, S = straight-block)
[, 9]	am	Transmission (0 = automatic, 1 = manual)  
[,10]	gear	Number of forward gears (3,4,5)
[,11]	carb	Number of carburetors (1,2,3,4,6,8)

# VI.          Process Data:  Cconvert columns 2 & 8:11 (cyl=(4,6,8), vs = engine block shape (0=V, 1=S), am into transmission type (0=automatic & 1=manual), gear=(3:5) & carb=(1,2,3,4,6,8) factor levels 
```{r ProcessData, echo=FALSE, message=TRUE, warning=TRUE, results='hide'}
data("mtcars")
for(i in c(2,8:11))mtcars[,i] <- as.factor(mtcars[,i])
str(mtcars)
```

# VII.         Descriptive Statistics (view first & last three rows)
```{r DataDescriptions, eval=FALSE, include=FALSE}
ordmtcars <- mtcars[order(mtcars$mpg,decreasing = FALSE),]
rbind(head(ordmtcars,3),tail(ordmtcars,3))
```


# VIII.           Exploratory Analysis:  
        See Appendix A, Figures 1:4
        Add narrative here!!
        
################-----------------##################
        
# IX.           Statistical Modeling, Regression & Model Fit:
        Assumptions:
                A A correlation to mpg ratings may exist among multiple variables
                B
## Multivariate Linear Model (all vars) Fitted Values, Quantiles & Leverage Plots
```{r MVLM(allvars), echo=FALSE, fig.height=4, fig.width=4, message=FALSE, warning=FALSE, results='hide'}
f1 <- lm(mpg ~ ., data = ordmtcars)
coef(summary(f1))
vif(f1)
par(mfrow = c(2, 2), mar = c(4, 4, 2, 1))
plot(f1)
# Note; vars with lowest vif = drat, vs & am
```

## Bivariate Linear Model: # Note: manual trans & eng shape / vs are significant
```{r BivariateLM, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
mvlmf <- lm(mpg ~ factor(am) + drat + vs, data = ordmtcars)
coef(summary(mvlmf))
vif(mvlmf)
par(mfrow = c(2, 2), mar = c(4, 5, 2, 1))
plot(mvlmf)
```

## Multivariate Linear Model Adjusted 
(Note: the variable qsec appears to be significant at this point)
```{r MVLM(allvars)F&A, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
mvlma <- lm(mpg ~ factor(am) + drat + vs  - 1, data = ordmtcars)
coef(summary(mvlma))
par(mfrow = c(2, 2), mar = c(4, 5, 2, 1))
plot(mvlma)
```

## Multivariate LM Nested & ANOVA table (Note: with nested modeling method, models 3 & 6 each add a significate variable to the fitted model and in this case model 3 is disp & model 6 is wt. Now use the vif (variable inflation) test on model six to check for any variance inflation among the varialbes of this model. The results show that "hp", "drat", and "wt" all have square rooted infaltion values less than 3.0 so these can be accepted into the model of best fit (fbf1) along with the main variable of the study "am"
```{r MVLM_ANOVA_table, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
fit <- lm(mpg ~ factor(am), data = ordmtcars)
fm2 <- update(fit, mpg ~ cyl)
fm3 <- update(fit, mpg ~ cyl + disp)
fm4 <- update(fit, mpg ~ cyl + disp + hp)
fm5 <- update(fit, mpg ~ cyl + disp + hp + drat)
fm6 <- update(fit, mpg ~ cyl + disp + hp + drat + wt)
fm7 <- update(fit, mpg ~ cyl + disp + hp + drat + wt +  qsec)
fm8 <- update(fit, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs)
fm9 <- update(fit, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs + gear)
fm10 <- update(fit, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs + gear + carb)
anova(fit, fm2, fm3, fm4, fm5, fm6, fm7, fm8, fm9, fm10)
vif(fm6)
sqrt(vif(fm6))
```


## Best Fit Modeling (Note: based on the nested modeling process followed by the anova table check then followed by the vif and sqrt(vif) test we decide to go with the following model labeled (fbf1) and notice that all of the sqrt(vif) values are less than 2.0 indicating a good model fit.
```{r BestFitModeling, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(car)
fbf1 <- lm(mpg ~ factor(am) + drat + hp + wt, data = ordmtcars)
vif(fbf1)
sqrt(vif(fbf1))
library(ggplot2)
par(mfrow = c(1,1), mar = c(4,4,2,2)) # set margin
g <- ggplot(mtcars, aes(x = am + drat + hp + wt, y = mpg),)
g <- g + xlab("am + drat + hp + wt")
g <- g + ylab("Miles per Gallon")
g <- g + geom_point(size = 3.0, col = "blue", alpha = 0.55)
g <- g + geom_smooth(method = "lm", col = "black")
g
```



```{r Fig.5_BestModelPlot, fig.height=5, fig.width=5, message=FALSE, warning=FALSE, include=FALSE}
data("mtcars")
fbf3 <- lm(mpg ~ factor(am) + drat + hp + wt, data = mtcars)
library(ggplot2)
par(mfrow = c(1,1), mar = c(4,4,2,2)) # set margin
g <- ggplot(mtcars, aes(x = cyl + disp + wt + am, y = mpg),)
g <- g + xlab("cyl + disp + wt + am")
g <- g + ylab("Miles per Gallon")
g <- g + geom_point(size = 3.0, col = "blue", alpha = 0.55)
g <- g + geom_smooth(method = "lm", col = "black")
g
```



# DIAGNOSTICS A
```{r ResidFit, fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
y <- mtcars$mpg
x <- (mtcars$am + mtcars$disp + mtcars$hp + mtcars$wt)
n <- length(y)
fw <- lm(y ~ x, data = mtcars)
e <- resid(fw)# ;e;plot(e);sum(e)
plot(x,e,
     xlab = "am + drat + hp + wt",
     ylab = "Residuals (MPG)",
     bg = "lightblue",
     col = "black", cex = 2, pch = 21, frame = FALSE)
abline(h = 0, lwd = 2)
for(i in 1:n)
        lines(c(x[i], x[i]), c(e[i], 0), col = "red", lwd = 2)
```


# DIAGNOSTICS B
```{r Fig.6_dfbetaPlots, echo=FALSE}
dfbetaPlots(lm(mpg ~ factor(am), data = mtcars, family = binomial))
par(mfrow = c(1, 1), mar = c(4.0, 3.0, 3.0, 3.0))
```


# It turns out that the confint for "am" 17.33614 - 42.71801 is rather wide and does not include zero meaning it may not be the best overall predictor of "mpg" rating values. On the other hand the much narrower confint of "drat", "hp", & "wt" indicate that they are likely to be good predictors of "mpg"
# however the confint for drat, hp and wt each include zero
```{r Fig.6_ConfInt, echo=TRUE, message=FALSE, warning=FALSE}
fbf3 <- lm(mpg ~ factor(am) + drat + hp + wt, data = mtcars)
coef(summary(fbf3))
scf3[1,1] + c(-1, 1) * qt(.975, df = fbf3$df) * scf3[1, 2]
scf3[2,1] + c(-1, 1) * qt(.975, df = fbf3$df) * scf3[2, 2]##****
scf3[3,1] + c(-1, 1) * qt(.975, df = fbf3$df) * scf3[3, 2]##****
scf3[4,1] + c(-1, 1) * qt(.975, df = fbf3$df) * scf3[4, 2]##****
```

############### NEXT PROCESS: the percentage of total variability explained by the linear relationship with the predictor !!!! #################

## Find something with levels
```{r Fig.7_Predict, echo=FALSE, fig.height=5, fig.width=6}
# fbf1 <- lm(mpg ~ factor(am) + cyl + disp + hp + drat + wt + qsec, data = mtcars)
```

# X.            Preliminary Findings:  
        Questions of Interest:
                A What other regressors if any correlated with mpg rating and transmission type?
                B 
        Interpretation of Results:
                A Using ANOVA table with Nested Multivariate Regression fit it is clear that the variable weight (wt) is significance according with a code of ** = 0.001
                B Based on the 
                C

# XI.           Inference:
        Hypothesis':
                A H0 = The difference between Automatic and Manual transmission MPG = 0   
                B Ha = The difference between Automatic and Manual transmission MPG != 0
                C Desired confidence interval = .95 (one sided) ??

# XII.          Conclusions / Recommendations:  
        A
        B

# XIII.         Are there other alternative analyses?
        A VIF
        B Challenge the results ?
        C Measures of uncertainty 'e'

---
# XIV.          Appendix A: "Exploratory Graphical Analysis""

## Pairs Plot
```{r Fig.1_Pairs, echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
pairs(mtcars[,c(1,2,6,9)], panel = panel.smooth, main = "MTCARS data set", col = 3)
```

## Histograms Plot
```{r Fig.2_Hist, echo=FALSE, fig.height=4.5, fig.width=5.5}
data(mtcars)
par(mfrow = c(2,1), mar = c(4,4,2,1)) # set margin
mtcars$vs <- factor(mtcars$vs, labels = c("V-block", "S-block")); mtcars$am <- factor(mtcars$am, labels = c("Auto", "Manual")); mtcars$gear <- factor(mtcars$gear); mtcars$carb <- factor(mtcars$carb)
head(mtcars,3)
hist(mtcars$mpg[mtcars$am=="Auto"], breaks=10, xlab = "Miles-Per-gallon", ylab = "Count", main = "Automatic Transmission", col = "yellow", xlim = range(5:40))
abline(v=mean(mtcars$mpg[mtcars$am=="Auto"]), col="red", lwd = 4)
hist(mtcars$mpg[mtcars$am=="Manual"], breaks=10, xlab = "Miles-Per-gallon", ylab = "Count", main = "Manual Transmission", col="lightblue", xlim = range(5:40))
abline(v=mean(mtcars$mpg[mtcars$am=="Manual"]), col="blue", lwd = 4)
```

## Box Plot
```{r Fig.3_BoxPlot, echo=FALSE, fig.height=4.5, fig.width=4.5}
data("mtcars");par(mfrow = c(1,1), mar = c(4,4,2,2))
mtcars$vs <- factor(mtcars$vs, labels = c("V-block", "S-block")); mtcars$am <- factor(mtcars$am, labels = c("Auto", "Manual")); mtcars$gear <- factor(mtcars$gear); mtcars$carb <- factor(mtcars$carb)
head(mtcars,3)
boxplot(mpg ~ am, data = mtcars, col = (c("yellow","lightblue")), ylab = "Miles-Per-Gallon", xlab = "Transmission", main =  "Automatic vs Manual Transmission, Miles Per Gallon Ratings")
```

## Simple Linear Regression Plot
```{r Fig.4_SimpleLR, echo=TRUE, fig.height=4.5, fig.width=4.5, message=FALSE, warning=FALSE}
library(ggplot2)
fit <- lm(mpg ~ factor(am), data = mtcars)
par(mfrow = c(1,1), mar = c(4,4,2,2)) # set margin
g <- ggplot(mtcars, aes(x = am, y = mpg),)
g + xlab("Transmission Type")
g + ylab("Miles per Gallon")
g + geom_smooth(method = "lm", col = "black")
g + geom_point(size = 3, col = "blue", alpha = 0.35)
g
```
## NOTE: use the cut function by 3 on MPG

===
END
===
