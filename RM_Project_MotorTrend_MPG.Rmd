---
title: "Regression Models Project - Motor Trend Data 'mtcars' Miles Per Gallon Analysis"
author: "james c walmsley"
date: "12/1/2016"
output: 
  pdf_document: 
    fig_caption: yes
    fig_crop: yes
    fig_height: 6
    fig_width: 6
---

# I.            Executive Summary:  
        ## Add after completing analysis
        NOTE: include some info on cor, confint, ChisSq?, VIF
# II.           Problem Statement & Questions to Answer:  
                ## Q1 “Is an automatic or manual transmission better for 'mpg'”  
                ## Q2 "Quantify the MPG difference between automatic and manual transmissions"  
#               Grading - Criteria (remove on completion)!!!  

YES!!!! Did the student interpret the coefficients correctly?  

YES!!!! Did the student do some exploratory data analyses?  

Did the student fit multiple models and detail their strategy for model selection?  

Did the student answer the questions of interest or detail why the question(s) is (are) not answerable?  

Did the student do a residual plot and some diagnostics?  

Did the student quantify the uncertainty in their conclusions and/or perform an inference correctly?  

Was the report brief (about 2 pages long) for the main body of the report and no longer than 5 with supporting appendix of figures?  

Did the report include an executive summary?  

YES!!!! Was the report done in Rmd (knitr) with pdf output?  

# III.          Analysis Considerations:
        Descriptive - (dim, mean, sd, sigma^2, str & summary) statistics
        
        Exploratory - pairs, histograms, QQ, fitted, residualplots, boxplots  
        & (multiple plots); T-Test
        
        Analysis -  OLS, simple linear regression, statistical linear regression,  
        multivariate regression & model selection, logistic regression, pValues, adjustments,         residuals, residual fit, predict fit, hatvalues, variance, & dfbetas, R^2,  
        diagnostics; ANOVA, coeficients, confint, correlation, covariance, variance inflation

# IV.           Software Environment:
        Set working directory:
```{r SetDirectory, echo=TRUE, results='hide'}
setwd("~/Desktop/Coursera_R/7_Regression Models/RM_proj_MPG_MotorTrendData")
```        
        System - session Info:
```{r SessionInfo, echo=TRUE, results='hide'}
sessionInfo()
```

# V.            Accessing Data:
        Clean up the work space & get the data: 
```{r GetData, echo=TRUE, results='hide'}
rm(list=ls()); data("mtcars");mtcars
```

# VI.           Raw Data Overview: Motor Trend 'mtcars' data set:  Descriptive Statistics
```{r DataOverview, echo=FALSE, results='hide'}
any(is.na(mtcars));head(mtcars, 3)
```
A data frame with 32 observations on 11 variables.  

[, 1]	mpg	Miles/(US) gallon  
[, 2]	cyl	Number of cylinders  
[, 3]	disp	Displacement (cu.in.)  
[, 4]	hp	Gross horsepower  
[, 5]	drat	Rear axle ratio  
[, 6]	wt	Weight (1000 lbs)  
[, 7]	qsec	1/4 mile time  
[, 8]	vs	V/S  
[, 9]	am	Transmission (0 = automatic, 1 = manual)  
[,10]	gear	Number of forward gears  
[,11]	carb	Number of carburetors  


# VII.          Process Data:  
        Transformationns = Factor variables 8:11; modify variable names for col 8 & 9
```{r ProcessData, echo=TRUE, results='hide'}
data("mtcars");for(i in c(2,8:11))mtcars[,i] <- as.factor(mtcars[,i]);mtcars[,]
```

# VIII.         Exploratory Analysis:  
        Add narrative here!!
```{r ExpAna_1, echo=TRUE, message=FALSE, warning=FALSE}
data(mtcars);library(car);library(dplyr)
h1 <- sapply(mtcars, range, simplify = TRUE);h1;mu1 <- sapply(mtcars, mean, simplify = TRUE);mu1
c1 <- sapply(mtcars, sd, simplify = TRUE);c1;c2 <- sapply(mtcars, var, simplify = TRUE);c2
ordmtcars <- mtcars[order(mtcars$mpg,decreasing = TRUE),]
ordmtcars2 <- mtcars[order(mtcars$mpg,decreasing = FALSE),]
rbind(head(ordmtcars2), head(ordmtcars))
```
        For additional exploratory graphical analysis see Appendix A, Figures 1:4 

# IX.           Statistical Modeling, Regression & Model Fit:
        Assumptions:
                A A correlation to mpg ratings may exist among multiple variables
                B
## Bivariate Linear Model
```{r BivariateLM, echo=FALSE, fig.height=4, fig.width=4, message=FALSE, warning=FALSE, results='hide'}
data("mtcars")
f2 <- lm(mpg ~ factor(am) + wt, data = mtcars);coef(summary(f2))
f3 <- lm(mpg ~ factor(am) * wt, data = mtcars);coef(summary(f3))
par(mfrow = c(1, 2), mar = c(4, 5, 2, 1))
plot(f2)
plot(f3)
```


## Multivariate LM (all vars) Fitted Plot
```{r MVLM(allvars)F, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
mvlmf <- lm(mpg ~ ., data = mtcars);coef(summary(mvlmf))
par(mfrow = c(2, 2), mar = c(4, 5, 2, 1))
coef(summary(mvlmf))
vif(mvlmf)

```

## Multivariate LM (all vars) Fitted & Adjusted 
(Note: the variable qsec appears to be significant at this point)
```{r MVLM(allvars)F&A, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
par(mfrow = c(2, 2), mar = c(4, 5, 2, 1));mvlmfa <- lm(mpg ~ . -1, data = mtcars);coef(summary(mvlmfa))
```

## MultivariateLM(allvars)VIF(varianceInflationFactor) 
(Note: at this point qsec no longer appears significant; but drat now appears to be instead, and notice the variance inflation figures of the other varables now seem to warrant removing them from the model)
```{r MVLM(allvars)VIF, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
mvlmfa <- lm(mpg ~ ., data = mtcars);coef(summary(mvlmfa));vif(mvlmfa);sqrt(vif(mvlmfa))
```

## Multivariate LM Nested & ANOVA table (Note: here that with the nested model approach that models 2 & 4 are indicated to be significant)
```{r MVLM_Nested_ANOVA_table, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
data("mtcars")
fm1 <- lm(mpg ~ factor(am), data = mtcars)
fm2 <- update(fm1, mpg ~ cyl + disp)
fm3 <- update(fm1, mpg ~ cyl + disp + hp + drat)
fm4 <- update(fm1, mpg ~ cyl + disp + hp + drat + wt +  qsec)
fm5 <- update(fm1, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs +  am)
fm6 <- update(fm1, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs +  am +  gear + carb)
anova(fm1, fm2, fm3, fm4, fm5, fm6)
```

## Best Fit Modeling (Note: comparing the following three models and using anova table test we find that model fbf3 is highly significant and therefore discard the other two models)
```{r BestFitModeling, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
data("mtcars"); library(car)
fbf1 <- lm(mpg ~ factor(am) + cyl + disp +  wt + qsec, data = mtcars)
vif(fbf1)
sqrt(vif(fbf1))
fbf2 <- lm(mpg ~ factor(am) + wt + qsec, data = mtcars)
vif(fbf2)
sqrt(vif(fbf2))
anova(fbf1,fbf2)
fbf3 <- lm(mpg ~ factor(am) + wt, data = mtcars)
vif(fbf3)
sqrt(vif(fbf3))
anova(fbf1,fbf2,fbf3)
```


```{r Fig.5_BestModelPlot, echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
fbf3 <- lm(mpg ~ factor(am) + wt, data = mtcars)
library(ggplot2)
g <- ggplot(mtcars, aes(x = wt, y = mpg),)
g <- g + xlab("Weight (Tons)")
g <- g + ylab("Miles per Gallon")
g <- g + geom_point(size = 6, colour = "black", alpha = 0.2)
g <- g + geom_point(size = 5, colour = "blue", alpha = 0.2)
g <- g + geom_smooth(method = "lm", colour = "black")
g
```


############### NEXT PROCESS TO CHECK!!!!! IS RESIDUALS TO IDENTIFY POOR MODEL FIT??

```{r ResidFit, message=FALSE, warning=FALSE}
y <- mtcars$mpg
x <- mtcars$wt
n <- length(y)
fw <- lm(x ~ y, data = mtcars)
e <- resid(fw)# ;e;plot(e);sum(e)
plot(x,e,
     xlab = "Vehicle Weight in Tons",
     ylab = "Residuals (MPG)",
     bg = "lightblue",
     col = "black", cex = 2, pch = 21, frame = FALSE)
abline(h = 0, lwd = 2)
for(i in 1:n)
        lines(c(x[i], x[i]), c(e[i], 0), col = "red", lwd = 2)
```

############### NEXT PROCESS: R^2 the percentage of total variability explained by the linear relationship with the predictor !!!!


```{r Fig.6_dfbetaPlots, echo=FALSE}
dfbetaPlots(lm(mpg ~ factor(am) + wt, data = mtcars, family = binomial))
par(mfrow = c(1, 2), mar = c(4.0, 3.0, 3.0, 3.0))
```


   ## ISSUE NEEDS RESOLUTION
```{r Fig.6_ConfInt, echo=FALSE}
fbf3 <- lm(mpg ~ am + wt, data = mtcars)
scf3 <- coef(summary(fbf3))
scf3
scf3[1,1] + c(-1, 1) * qt(.975, df = fbf3$df) * scf3[1, 2]
scf3[2,1] + c(-1, 1) * qt(.975, df = fbf3$df) * scf3[2, 2]
```


## Find something with levels
```{r Fig.7_Predict, echo=FALSE, fig.height=5, fig.width=6}
# fbf1 <- lm(mpg ~ factor(am) + cyl + disp + hp + drat + wt + qsec, data = mtcars)
# xVals <- mtcars$wt
# yVals <- mtcars$mpg
# plot(x, y, frame=FALSE,xlab="Weight", xlim=range(1000:6000), ylab="Miles per Gallon", ylim=range(5:40), pch=21,col="black", bg="lightblue", cex=2)
# abline(fbf1, lwd = 2)
# xVals <- seq(min(x), max(x), by = .01)
# b0 <- coef(summary(fbf1))[1];b0
# b1 <- sum(coef(summary(fbf1))[1,1] + coef(summary(fbf1))[2,1]);b1
# yVals <- b0 + b1 * xVals
# se1 <- sigma * sqrt(1 / n + (xVals - mean(x))^2/ssx)
# se2 <- sigma * sqrt(1 + 1 / n + (xVals - mean(x))^2/ssx)
# lines(xVals, yVals + 2 * se1)
# lines(xVals, yVals - 2 * se1)
# lines(xVals, yVals + 2 * se2)
# lines(xVals, yVals - 2 * se2)
```

# X.            Preliminary Findings:  
        Questions of Interest:
                A What other regressors if any correlated with mpg rating and transmission type?
                B 
        Interpretation of Results:
                A Using ANOVA table with Nested Multivariate Regression fit it is clear that the variable weight (wt) is significance according with a code of ** = 0.001
                B Based on the 
                C

# XI.           Inference:
        Hypothesis':
                A H0 = The difference between Automatic and Manual transmission MPG = 0   
                B Ha = The difference between Automatic and Manual transmission MPG != 0
                C Desired confidence interval = .95 (one sided) ??

# XII.          Conclusions / Recommendations:  
        A
        B

# XIII.         Are there other alternative analyses?
        A VIF
        B Challenge the results ?
        C Measures of uncertainty 'e'

---
# XIV.          Appendix A: "Exploratory Graphical Analysis""

## Pairs Plot
```{r Fig.1_Pairs, echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
pairs(mtcars[,c(1,4,6,9)])
```

## Histograms Plot
```{r Fig.2_Hist, echo=FALSE, fig.height=4.5, fig.width=5.5}
data(mtcars)
par(mfrow = c(2,1), mar = c(4,4,2,1)) # set margin
mtcars$vs <- factor(mtcars$vs, labels = c("V-block", "S-block")); mtcars$am <- factor(mtcars$am, labels = c("Auto", "Manual")); mtcars$gear <- factor(mtcars$gear); mtcars$carb <- factor(mtcars$carb)
head(mtcars,3)
hist(mtcars$mpg[mtcars$am=="Auto"], breaks=10, xlab = "Miles-Per-gallon", ylab = "Count", main = "Automatic Transmission", col = "yellow", xlim = range(5:40))
abline(v=mean(mtcars$mpg[mtcars$am=="Auto"]), col="red", lwd = 4)
hist(mtcars$mpg[mtcars$am=="Manual"], breaks=10, xlab = "Miles-Per-gallon", ylab = "Count", main = "Manual Transmission", col="lightblue", xlim = range(5:40))
abline(v=mean(mtcars$mpg[mtcars$am=="Manual"]), col="blue", lwd = 4)
```

## Box Plot
```{r Fig.3_BoxPlot, echo=FALSE, fig.height=4.5, fig.width=4.5}
data("mtcars")
mtcars$vs <- factor(mtcars$vs, labels = c("V-block", "S-block")); mtcars$am <- factor(mtcars$am, labels = c("Auto", "Manual")); mtcars$gear <- factor(mtcars$gear); mtcars$carb <- factor(mtcars$carb)
head(mtcars,3)
boxplot(mpg ~ am, data = mtcars, col = (c("yellow","lightblue")), ylab = "Miles-Per-Gallon", xlab = "Transmission", main =  "Automatic vs Manual Transmission, Miles Per Gallon Ratings")
```

## Simple Linear Regression Plot
```{r Fig.4_SimpleLR, echo=FALSE, fig.height=6, fig.width=6, message=FALSE, warning=FALSE}
par(mfrow = c(2, 2), mar = c(4, 5, 2, 1));fslrm <- lm(mpg ~ am, data = mtcars);
coef(summary(fslrm))
library(ggplot2)
g <- ggplot(mtcars, aes(x = am, y = mpg),)
g <- g + xlab("Transmission Type")
g <- g + ylab("Miles per Gallon")
g <- g + geom_point(size = 6, colour = "black", alpha = 0.2)
g <- g + geom_point(size = 5, colour = "blue", alpha = 0.2)
g <- g + geom_smooth(method = "lm", colour = "black")
g
```


===
END
===

