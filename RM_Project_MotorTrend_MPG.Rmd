---
title: "Regression Models Course Project - Motor Trend Data Set - 'mtcars' Miles Per Gallon Ratings Analysis"
author: "james c walmsley"
date: "12/1/2016"
output:
  html_document: default
  pdf_document:
    fig_caption: yes
    fig_height: 5.5
---

#       Executive Summary:    

        
#       Problem Statement & Questions:    
                ## Q1 “Is an automatic or manual transmission better for 'mpg'”  
                ## Q2 "Quantify the MPG difference between automatic and manual  
                transmissions"  
---

A data frame with 32 observations on 11 variables.  

[, 1]	mpg	Miles/(US) gallon    
[, 2]	cyl	Number of cylinders (4,6,8)  
[, 3]	disp	Displacement (cu.in.)    
[, 4]	hp	Gross horsepower    
[, 5]	drat	Rear axle ratio    
[, 6]	wt	Weight (1000 lbs)    
[, 7]	qsec	1/4 mile time    
[, 8]	vs	V/S (V = vee-block, S = straight-block)  
[, 9]	am	Transmission (0 = automatic, 1 = manual)    
[,10]	gear	Number of forward gears (3,4,5)  
[,11]	carb	Number of carburetors (1,2,3,4,6,8)  


#       Exploratory Analysis:    
Develop r code to analyze and identify any significant relationships /  
correlations positively or negatively affecting the vehicle  mpg ratings.
Create a pairs plot, histogram and box plot to visually represent the key   
elements of the structure and summary statistics in the descriptive statistics.



#############





#       Statistical Modeling:  
### Regression & Model Fit:    
        ## Assumptions:    
                ## A     
                ## B    

#       Simple Linear Regression Plot:
Examine the relationship between mpg ratings and transmission type; automatic vs manual
```{r Fig.4_SimpleLR, echo=FALSE, eval=FALSE, fig.align='center',fig.height=4.0, fig.width=6.5, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
ordmtcars$am <- factor(ordmtcars$am, labels = c("Auto", "Manual"))
f1 <- lm(mpg ~ am, data = ordmtcars)
coef(summary(f1))
par(mfrow = c(1,1), mar = c(2,2,2,2)) # set margin
g <- ggplot(ordmtcars, aes(x = factor(am), y = mpg),)
g <- g + xlab("Transmission Type")
g <- g + ylab("Miles per Gallon")
g <- g + geom_point(size = 4.0, col = "blue", alpha = .45)
g <- g + geom_abline(intercept = 9.91, slope = 7.24) # adjusted (-7.24) to fit grid
g
```


#       Bivariate Linear Model:  
Examine the relationship between mpg & two variables: am & weight beacuse weight has an -86%  
negative correlation with mpg (the highest single variable correlation with mpg)
```{r Fig.5_BivariateLM_1, echo=FALSE, eval=FALSE, fig.align='center', fig.height=6.0, fig.width=7.5, message=FALSE, warning=FALSE, include=FALSE, results='hide'}
library(car)
f2 <- lm(mpg ~ as.numeric(am) + wt, data = ordmtcars)
hatvalues(f2);coef(summary(f2));vif(f2);sqrt(vif(f2))
par(mfrow = c(2,2), mar = c(4,4,3,2)) # set margin
plot(f2)
```

```{r Fig.5_BivariateLM_2, echo=FALSE, eval=FALSE, fig.align='center', fig.height=4, fig.width=7, message=FALSE, warning=FALSE, include=FALSE, results='hide'}
library(car)
f2 <- lm(mpg ~ as.numeric(am) + wt, data = ordmtcars)
par(mfrow = c(1,1), mar = c(4,4,4,2))
g <- ggplot(mtcars, aes(x = as.numeric(am) + wt , y = mpg),)
g <- g + xlab("Transmission Type + Weight")
g <- g + ylab("Miles per Gallon")
g <- g + geom_smooth(aes(method = "lm", se = FALSE))
g <- g + geom_point(size = 3.5, col = "blue", alpha = .65)
g
```

#       Multivariate Linear Model:

The influence measures test indicates that the following vehicles exhibit  
substatial influence on the model fit; "Merc 230","Merc 280", "Honda Civic",  
"Camaro Z28","Porsche 914-2","ford Pantera L","ferrari Dino","Maserati Bora"
based on the cov.r (covariance ratio) at 2.809 or above


```{r Fig.6_MVLM(allvars), echo=FALSE, eval=c(1,2,4,7:19), fig.align='center', fig.height=7, fig.width=9, message=FALSE, warning=FALSE, include=FALSE, results='hide'}
library(car);library(ggplot2)
data("mtcars")
as.numeric(unlist(mtcars))
f3 <- lm(mpg ~ ., data = mtcars)
coef(summary(f3))
vif(f3)
sqrt(vif(f3))
par(mfrow = c(1, 1), mar = c(3,3,3,2))
g <- ggplot(mtcars, aes(x = (cyl + disp + hp + drat + wt + qsec + vs + am + gear + carb), y = mpg),)
g <- g + xlab("All Design Components Inclusive")
g <- g + ylab("Miles per Gallon")
g <- g + geom_smooth(aes(method = "lm", se = FALSE))
g <- g + geom_point(aes(shape = factor(am), size = 4.0))
g <- g + geom_point(aes(colour = factor(cyl)))
g
```

#       Multivariate Linear Model (all vars) Adjusted:
```{r Fig.7a_MVLM(allvars,-1), echo=FALSE,  eval=c(1,2,5:12), fig.align='center', fig.height=7,fig.width=9, message=FALSE, warning=FALSE, include=FALSE, results='hide'}
library(car);library(ggplot2)
f6 <- lm(mpg ~ . -1, data = ordmtcars)
coef(summary(f6))
confint(f6)
par(mfrow = c(1,1), mar = c(4,4,2,2)) # set margin
g <- ggplot(mtcars, aes(x = cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb, am, -1, y = mpg),)
g <- g + xlab("Multivariate(allvars)- Adjusted to Intercept")
g <- g + ylab("Miles per Gallon")
g <- g + geom_smooth(aes(method = "lm", se = FALSE))
g <- g + geom_point(aes(shape = factor(am), size = 4.0))
g <- g + geom_point(aes(colour = factor(cyl)))
g
```



#       Multivariate Linear Model (all vars - am):

Remove the am variable from the multivariate linear regression to see what  
effect it has on the fit

```{r Fig.7b_MVLM(allvars,-am), echo=TRUE, eval=TRUE, fig.height=4, fig.width=4, message=FALSE, warning=FALSE, include=FALSE, results='hide'}
data("mtcars");as.numeric(unlist(mtcars))
f4 <- lm(mpg ~ . - am, data = mtcars)
coef(summary(f4));vif(f4);sqrt(vif(f4));# plot(f3)
par(mfrow = c(1, 1), mar = c(4,4,4,2))
g <- ggplot(mtcars, aes(x = (cyl + disp + hp + drat + wt + qsec + vs + gear + carb), y = mpg),)
g <- g + xlab("All Design Components - am")
g <- g + ylab("Miles per Gallon")
g <- g + geom_smooth(aes(method = "lm", se = FALSE))
g <- g + geom_point(size = 2.5, col = "black", alpha = .85)
g <- g + geom_point(aes(shape = factor(gear), size = 4.5, colour = "white"))
g <- g + geom_point(aes(colour = factor(cyl), size = 3.5))
g <- g + geom_point(aes(size = drat), alpha = .4)
g
# par(mfrow = c(2, 2), mar = c(4,4,4,2))
# plot(f4)
```


##      Multivariate LM Nested & ANOVA table 
Using a nested model approach, followed by checking for variance inflation  
using the command vif we can see that cyl, disp & hp 

```{r Fig.8_MVLM_ANOVA_table.test, message=FALSE, warning=FALSE, include=FALSE, results='hide'}
fn1 <- lm(mpg ~ factor(am), data = mtcars)
fnm2 <- update(fn1, mpg ~ cyl + disp)
fnm3 <- update(fn1, mpg ~ cyl + disp + hp + drat)
fnm4 <- update(fn1, mpg ~ cyl + disp + hp + drat + wt +  qsec)
fnm5 <- update(fn1, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs + am)
fnm6 <- update(fn1, mpg ~ cyl + disp + hp + drat + wt +  qsec + vs + am + gear + carb)
anova(fn1, fnm2, fnm3, fnm4, fnm5, fnm6)
vif(fnm6)
vif(fnm4)
sqrt(vif(fnm4))
confint(fnm4)
par(mfrow = c(2,2), mar = c(4,4,4,2))
plot(fnm4)
```


#       Multivarite Linear Model Finding Best Fit with Step function:
```{r MVLM_Step_R^2, echo=TRUE, eval=TRUE, cache=TRUE, include=TRUE, results='asis'}
library(stats);library(MASS)
fstp <- lm(mpg ~ ., data = mtcars)
stp <- step(fstp, trace = FALSE)
coef(summary(stp))
summary(stp)$r.squared
```


Based on the nested modeling process followed by the anova table check then  
followed by the vif and sqrt(vif) test and the step function we decide to go  
with the following model labeled (fstp) 
```{r Fig.9a_BestFitModeling, eval=FALSE, fig.height=5, fig.width=5, message=TRUE, warning=TRUE, include=FALSE, results='hide'}
data("mtcars");library(car);library(ggplot2);library(graphics)
stp
mtc <- mtcars
mtc$am <- c("0" = "automatic", "1" = "manual")[as.character(mtc$am)]
x <- (mtc$wt + mtc$qsec + mtc$am)
par(mfrow = c(1,1), mar = c(4,4,2,2)) # set margin
g <- ggplot(mtc, aes(x = x, y = mpg),)
g <- g + xlab("(wt + qsec + am)")
g <- g + ylab("Miles per Gallon")
g <- g + geom_smooth(method = "loess")
g <- g + geom_point(aes(shape = factor(am), size = wt, colour = qsec, alpha = .85))
g
```





#       Any alternative analyses?
        A VIF
        B Challenge the results ?
        C Measures of uncertainty 'e'

---
#       Appendix A: Figures for the "Exploratory Analysis"

##      Pairs Plot: 
Interpretation: MPG decreases as the; # of cylinders increases, the engine  
displacement increases, the horsepower increases, the weight increases, the rear  
axle ratio decreases, qsec time decreases, the engine is a V-block, # of gears  
decreases, and the # of carburators increases ~ conversely the MPG increases as  
the: rear axle ratio increases, qsec time increases, the engine is a  
Straight-block, transmission is manual, # of gears increases and the # of  
carburators decreases


```{r Fig.1_Pairs, echo=FALSE, fig.align='center', fig.height=5, fig.width=6.5, message=FALSE, warning=FALSE}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(mtcars[1:11], lower.panel=panel.smooth, upper.panel = panel.cor, cex=1.5, pch=20, col="lightblue", cex.labels=2, font.lables =2, main = "MPG mtcars data")
```

##      Histogram:
```{r Fig.2_Hist, echo=FALSE, fig.align='center', fig.height=4.0, fig.width=6.5}
data(mtcars)
par(mfrow = c(2,1), mar = c(4,4,4,4)) # set margin
mtcars$vs <- factor(mtcars$vs, labels = c("V-block", "S-block")); mtcars$am <- factor(mtcars$am, labels = c("Auto", "Manual")); mtcars$gear <- factor(mtcars$gear); mtcars$carb <- factor(mtcars$carb)
hist(mtcars$mpg[mtcars$am=="Auto"], breaks=10, xlab = "Miles-Per-gallon", ylab = "Frequency", main = "Automatic Transmission", col = "yellow", xlim = range(5:40))
abline(v=mean(mtcars$mpg[mtcars$am=="Auto"]), col="red", lwd = 4)
hist(mtcars$mpg[mtcars$am=="Manual"], breaks=10, xlab = "Miles-Per-gallon", ylab = "Frequency", main = "Manual Transmission", col="lightblue", xlim = range(5:40))
abline(v=mean(mtcars$mpg[mtcars$am=="Manual"]), col="blue", lwd = 4)
```

##      Box Plot:
```{r Fig.3_BoxPlot, echo=FALSE, fig.align='center', fig.height=4, fig.width=6.5}
data("mtcars");par(mfrow = c(1,1), mar = c(4,4,4,4))
mtcars$vs <- factor(mtcars$vs, labels = c("V-block", "S-block")); mtcars$am <- factor(mtcars$am, labels = c("Auto", "Manual")); mtcars$gear <- factor(mtcars$gear); mtcars$carb <- factor(mtcars$carb)
boxplot(mpg ~ am, data = mtcars, col = (c("yellow","lightblue")), ylab = "Miles-Per-Gallon", xlab = "Transmission", main =  "Automatic vs Manual Transmission, Miles Per Gallon Ratings")
```


===
        END
===

